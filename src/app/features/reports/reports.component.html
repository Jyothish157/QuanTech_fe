<section class="page">
  <h2>Reports & Analytics</h2>

  <!-- KPI Row -->
  <div class="kpi-row">
    <div class="kpi" style="--c:#5C3AFF">
      <div class="icon">‚è±Ô∏è</div>
      <div class="meta">
        <div class="title">Total Work Hours</div>
        <div class="value">{{ totalWorkHours }}h</div>
      </div>
    </div>
    <div class="kpi" style="--c:#58C4A8">
      <div class="icon">üìà</div>
      <div class="meta">
        <div class="title">Average Work Hours</div>
        <div class="value">{{ averageWorkHours }}h</div>
      </div>
    </div>
    <div class="kpi" style="--c:#4F46E5">
      <div class="icon">‚úÖ</div>
      <div class="meta">
        <div class="title">Approved Leaves</div>
        <div class="value">{{ approvedLeaveRequests }}</div>
      </div>
    </div>
    <div class="kpi" style="--c:#F59E0B">
      <div class="icon">‚è≥</div>
      <div class="meta">
        <div class="title">Pending Leaves</div>
        <div class="value">{{ pendingLeaveRequests }}</div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="charts-row">
    <div class="card">
      <div class="card-title">Month-wise Leave Chart</div>
      <apx-chart
        [series]="leaveChartOptions['series']"
        [chart]="leaveChartOptions['chart']"
        [xaxis]="leaveChartOptions['xaxis']"
        [yaxis]="leaveChartOptions['yaxis']"
        [grid]="leaveChartOptions['grid']"
        [stroke]="leaveChartOptions['stroke']"
        [markers]="leaveChartOptions['markers']"
        [tooltip]="leaveChartOptions['tooltip']"
      ></apx-chart>
    </div>

    <div class="card">
      <div class="card-title">Leave Distribution</div>
      <apx-chart
        [series]="pieChartOptions['series']"
        [chart]="pieChartOptions['chart']"
        [labels]="pieChartOptions['labels']"
        [responsive]="pieChartOptions['responsive']"
        [dataLabels]="pieChartOptions['dataLabels']"
      ></apx-chart>
    </div>

    <div class="card">
      <div class="card-title">Shift Coverage</div>
      <div class="shift-coverage">
        <div class="coverage-item" *ngFor="let coverage of shiftCoverage">
          <div class="coverage-label">{{ coverage.shift }}</div>
          <div class="coverage-bar"><div class="coverage-fill" [style.width.%]="coverage.coverage"></div></div>
          <div class="coverage-value">{{ coverage.coverage }}%</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Tru‚ÄëTime (Avg Hours by Employee)</div>
      <div class="tru-time">
        <div class="row" *ngFor="let emp of getEmployees()">
          <span class="name">{{ getEmployeeName(emp.EmployeeID) }}</span>
          <div class="bar-wrap">
            <div class="bar-fill" [style.width.%]="(getEmployeeAverageHours(emp.EmployeeID) * 12.5) > 100 ? 100 : (getEmployeeAverageHours(emp.EmployeeID) * 12.5)"></div>
          </div>
          <span class="hrs">{{ getEmployeeAverageHours(emp.EmployeeID) }}h</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Table Row -->
  <div class="card table-card">
    <div class="card-header">
      <div class="card-title">Attendance Report</div>
      <!-- Single merged download method -->
      <button class="download-btn" (click)="downloadAttendanceReport()">
        <i class="fas fa-download"></i> Download PDF
      </button>
    </div>
    <div class="table-scroll">
      <table class="table">
        <thead>
          <tr>
            <th>ReportID</th>
            <th>EmployeeID</th>
            <th>Name</th>
            <th>Days Worked</th>
            <th>Total Hours</th>
            <th>Average Hours</th>
            <th>Absent Days</th>
            <th>Leave Balance</th>
            <th>Date Range</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let employee of getEmployees(); let i = index">
            <td>{{ 'RPT' + (i+1) }}</td>
            <td>{{ employee.EmployeeID }}</td>
            <td>{{ getEmployeeName(employee.EmployeeID) }}</td>
            <td>{{ getEmployeeAttendanceDays(employee.EmployeeID) }}</td>
            <td>{{ getEmployeeTotalHours(employee.EmployeeID) }}h</td>
            <td>{{ getEmployeeAverageHours(employee.EmployeeID) }}h</td>
            <td>{{ getEmployeeAbsentDays(employee.EmployeeID) }}</td>
            <td>{{ getEmployeeLeaveBalance(employee.EmployeeID) }}</td>
            <td>{{ getCurrentMonthDateRange() }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
