<section class="page">
  <!-- Submit New Leave Request Section -->
  <div class="form-section">
    <h2 class="main-heading">Submit New Leave Request</h2>

    <div
      class="message"
      *ngIf="message"
      [class.success]="message.includes('successfully')"
      [class.error]="message.includes('Insufficient')"
    >
      {{ message }}
    </div>

    <form class="form" (ngSubmit)="submit()">
      <div class="form-grid">
        <label>
          Leave Type
          <select [(ngModel)]="form.type" name="type" required>
            <option *ngFor="let t of types" [value]="t">{{ t }}</option>
          </select>
        </label>
        <label>
          Start Date
          <input type="date" [(ngModel)]="form.from" name="from" required />
        </label>
        <label>
          End Date
          <input type="date" [(ngModel)]="form.to" name="to" required />
        </label>
        <label>
          Reason (Optional)
          <input
            type="text"
            [(ngModel)]="form.reason"
            name="reason"
            placeholder="Enter reason for leave"
          />
        </label>
      </div>
      <button class="btn submit-btn" type="submit">Submit Leave Request</button>
    </form>
  </div>

  <!-- Tables Section -->
  <div class="tables-section">
    <!-- My Leave Requests -->
    <div class="table-card">
      <div class="card-title">My Leave Requests</div>
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Days</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of myRequests">
              <td>{{ r.LeaveType }}</td>
              <td>{{ r.StartDate }}</td>
              <td>{{ r.EndDate }}</td>
              <td>{{ calcDays(r.StartDate, r.EndDate) }}</td>
              <td>
                <span
                  class="badge"
                  [class.approved]="r.Status === 'Approved'"
                  [class.pending]="r.Status === 'Pending'"
                  [class.rejected]="r.Status === 'Rejected'"
                >
                  {{ r.Status }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pending Requests (Manager View) -->
    <div class="table-card" *ngIf="isManager">
      <div class="card-title">Pending Requests (Manager View)</div>
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Days</th>
              <th>Reason</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of pendingRequests">
              <td>{{ getEmployeeName(r.EmployeeID) }}</td>
              <td>{{ r.LeaveType }}</td>
              <td>{{ r.StartDate }}</td>
              <td>{{ r.EndDate }}</td>
              <td>{{ calcDays(r.StartDate, r.EndDate) }}</td>
              <td>{{ r.Reason || '-' }}</td>
              <td class="actions-cell">
                <button
                  class="btn approve-btn"
                  (click)="approveRequest(r.LeaveID)"
                >
                  Approve
                </button>
                <button
                  class="btn reject-btn"
                  (click)="rejectRequest(r.LeaveID)"
                >
                  Reject
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
